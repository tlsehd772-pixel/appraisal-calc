import streamlit as st
import datetime

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(page_title="ê°ì •í‰ê°€ ì‹¤ë¬´/ì´ë¡  ê³„ì‚°ê¸°", layout="wide")

# --- ìŠ¤íƒ€ì¼ë§ (ê°€ë…ì„± í–¥ìƒ) ---
st.markdown("""
    <style>
    .big-font { font-size:20px !important; font-weight: bold; }
    .info-box { background-color: #e8f4f8; padding: 15px; border-radius: 10px; border-left: 5px solid #0078d7; }
    .warning-box { background-color: #fff3cd; padding: 15px; border-radius: 10px; border-left: 5px solid #ffc107; }
    </style>
    """, unsafe_allow_html=True)

st.title("ğŸ§® ê°ì •í‰ê°€ì‚¬ ìˆ˜í—˜/ì‹¤ë¬´ í†µí•© ê³„ì‚°ê¸°")
st.markdown("ìˆ˜í—˜ìƒ: ì‹ í˜„ë™ | ëª©í‘œ: ê°ì •í‰ê°€ì‚¬ í•©ê²©")
st.markdown("---")

# --- ì‚¬ì´ë“œë°”: í‰ê°€ ë°©ì‹ ì„ íƒ ---
menu = st.sidebar.selectbox(
    "í‰ê°€ ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”",
    [
        "ğŸ  í™ˆ / í‰ê°€ ê°€ì´ë“œ (ë¶„ë¥˜í‘œ)",   # ğŸ‘ˆ ìƒˆë¡œ ì¶”ê°€ë¨ (ê¸°ë³¸ í™”ë©´)
        "í† ì§€ (ê³µì‹œì§€ê°€ê¸°ì¤€ë²•)", 
        "ê±´ë¬¼ (ì›ê°€ë²•)", 
        "í† ì§€ê±´ë¬¼ ì¼ê´„/êµ¬ë¶„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)",
        "ìˆ˜ìµì„± ë¶€ë™ì‚° (ìˆ˜ìµí™˜ì›ë²•)",
        "íˆ¬ìíƒ€ë‹¹ì„±/ê°€ì¹˜ (í• ì¸í˜„ê¸ˆìˆ˜ì§€ë¶„ì„ë²• DCF)",
        "ì„ëŒ€ë£Œ (ì ì‚°ë²•)",
        "ì„ëŒ€ë£Œ (ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•)",
        "í† ì§€/ê±´ë¬¼ ê°€ì¹˜ ë¶„ë¦¬ (ì”ì—¬ë²• & íˆ¬ìê²°í•©ë²•)",
        "ê³µê³µì‚¬ì—… ë³´ìƒ (ë³´ìƒí‰ê°€)",
        "ì¬ê°œë°œ/ì¬ê±´ì¶• (ì •ë¹„ì‚¬ì—…í‰ê°€)"
    ]
)
# ==============================================================================
# 0. í™ˆ / í‰ê°€ ê°€ì´ë“œ (Dashboard)
# ==============================================================================
if menu == "ğŸ  í™ˆ / í‰ê°€ ê°€ì´ë“œ (ë¶„ë¥˜í‘œ)":
    st.header("ğŸ‘‹ ê°ì •í‰ê°€ì‚¬ ì‹¤ë¬´ ê°€ì´ë“œ")
    st.markdown("### ğŸ’¡ ë¬´ì—‡ì„ í‰ê°€í•˜ì‹œë‚˜ìš”? (ê°ì •í‰ê°€ê·œì¹™ ì œ14ì¡°~25ì¡°)")
    st.info("ë¬¼ê±´ì˜ ì¢…ë¥˜ì— ë”°ë¼ ì ìš©í•´ì•¼ í•  **'ì£¼ëœ í‰ê°€ë°©ë²•'**ì´ ë²•ìœ¼ë¡œ ì •í•´ì ¸ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ í‘œë¥¼ ë³´ê³  ì ì ˆí•œ ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”.")

    # íƒ­ìœ¼ë¡œ ë³´ê¸° í¸í•˜ê²Œ êµ¬ë¶„
    tab1, tab2, tab3, tab4 = st.tabs(["ğŸ—ï¸ ìœ í˜•ìì‚° (í† ì§€/ê±´ë¬¼)", "ğŸš— ë™ì‚°/ê¸°íƒ€ìì‚°", "ğŸ’¼ ê¶Œë¦¬/ê¸°ì—…ê°€ì¹˜", "âš–ï¸ ëª©ì ë³„ ë¹„êµ (ë‹´ë³´/ë³´ìƒ/ì •ë¹„)"])

    with tab1:
        st.markdown("""
        | í‰ê°€ ëŒ€ìƒ | ì£¼ëœ í‰ê°€ë°©ë²• (ì›ì¹™) | í”„ë¡œê·¸ë¨ ë©”ë‰´ ì„ íƒ |
        | :--- | :--- | :--- |
        | **í† ì§€** | **ê³µì‹œì§€ê°€ê¸°ì¤€ë²•** | ğŸ‘‰ `í† ì§€ (ê³µì‹œì§€ê°€ê¸°ì¤€ë²•)` |
        | **ê±´ë¬¼** | **ì›ê°€ë²•** | ğŸ‘‰ `ê±´ë¬¼ (ì›ê°€ë²•)` |
        | **í† ì§€+ê±´ë¬¼ (ì¼ê´„)** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        | **ì§‘í•©ê±´ë¬¼ (ì•„íŒŒíŠ¸)** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        | **ì‚°ë¦¼ (ì„ì§€/ì…ëª©)** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** (ì›ì¹™) | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        | **ê³¼ìˆ˜ì›** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        """)
        st.warning("âš ï¸ **ì£¼ì˜:** í† ì§€ë„ 'ì ì •í•œ ì‹¤ê±°ë˜ê°€'ê°€ ìˆë‹¤ë©´ ê±°ë˜ì‚¬ë¡€ë¹„êµë²•ì„ ì ìš©í•  ìˆ˜ ìˆìŒ.")

    with tab2:
        st.markdown("""
        | í‰ê°€ ëŒ€ìƒ | ì£¼ëœ í‰ê°€ë°©ë²• (ì›ì¹™) | í”„ë¡œê·¸ë¨ ë©”ë‰´ ì„ íƒ |
        | :--- | :--- | :--- |
        | **ê±´ì„¤ê¸°ê³„** | **ì›ê°€ë²•** | ğŸ‘‰ `ê±´ë¬¼ (ì›ê°€ë²•)` íƒ­ í™œìš© (ê°ê°€ìˆ˜ì •) |
        | **ì„ ë°• / í•­ê³µê¸°** | **ì›ê°€ë²•** | ğŸ‘‰ `ê±´ë¬¼ (ì›ê°€ë²•)` íƒ­ í™œìš© |
        | **ìë™ì°¨** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        | **ë™ì‚° (ê°€êµ¬ ë“±)** | **ê±°ë˜ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `í† ì§€ê±´ë¬¼ ì¼ê´„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)` |
        """)
        st.caption("â€» **ê¿€íŒ:** ìë™ì°¨ëŠ” ê±°ë˜ì‚¬ë¡€ë¹„êµë²•ì´ì§€ë§Œ, ê±´ì„¤ê¸°ê³„ëŠ” ì›ê°€ë²•ì…ë‹ˆë‹¤. (ì‹œí—˜ ë‹¨ê³¨ í•¨ì •!)")

    with tab3:
        st.markdown("""
        | í‰ê°€ ëŒ€ìƒ | ì£¼ëœ í‰ê°€ë°©ë²• (ì›ì¹™) | í”„ë¡œê·¸ë¨ ë©”ë‰´ ì„ íƒ |
        | :--- | :--- | :--- |
        | **ê´‘ì—…ì¬ë‹¨ / ê³µì¥ì¬ë‹¨** | **ìˆ˜ìµí™˜ì›ë²•** | ğŸ‘‰ `ìˆ˜ìµì„± ë¶€ë™ì‚° (ìˆ˜ìµí™˜ì›ë²•)` |
        | **ì˜ì—…ê¶Œ / íŠ¹í—ˆê¶Œ** | **ìˆ˜ìµí™˜ì›ë²•** | ğŸ‘‰ `íˆ¬ìíƒ€ë‹¹ì„±/ê°€ì¹˜ (DCF)` |
        | **ì„ëŒ€ë£Œ** | **ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•** | ğŸ‘‰ `ì„ëŒ€ë£Œ (ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•)` |
        | **ê¸°ì—…ê°€ì¹˜** | **ìˆ˜ìµí™˜ì›ë²•** | ğŸ‘‰ `íˆ¬ìíƒ€ë‹¹ì„±/ê°€ì¹˜ (DCF)` |
        """)
    # --- [New] ëª©ì ë³„ ë¹„êµ íƒ­ ---
    with tab4:
        st.subheader("âš–ï¸ í‰ê°€ ëª©ì ë³„ í•µì‹¬ ê¸°ì¤€ ë¹„êµ")
        st.markdown("ì‹¤ë¬´ì™€ ì´ë¡  ì‹œí—˜ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ **4ëŒ€ í‰ê°€ ëª©ì **ì˜ ì°¨ì´ì ì…ë‹ˆë‹¤.")
        
        # ê°€ë…ì„±ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ ì ìš©ëœ í‘œ
        st.markdown("""
        | êµ¬ë¶„ | **ì¼ë°˜ í‰ê°€** (ë§¤ë§¤ ë“±) | **ë‹´ë³´ í‰ê°€** | **ë³´ìƒ í‰ê°€** (ê²½ë§¤/ê³µë§¤ í¬í•¨) | **ì •ë¹„ì‚¬ì—… í‰ê°€** (ì¬ê°œë°œ) |
        | :--- | :--- | :--- | :--- | :--- |
        | **ê·¼ê±° ë²•ë ¹** | ê°ì •í‰ê°€ë²• / ê°ì¹™ | ì€í–‰ì—…ê°ë…ê·œì • / ê°ì¹™ | **í† ì§€ë³´ìƒë²•** | **ë„ì‹œì •ë¹„ë²•** |
        | **í‰ê°€ ê°€ì•¡** | **ì‹œì¥ê°€ì¹˜** (Market Value) | **ì‹œì¥ê°€ì¹˜** (ë³´ìˆ˜ì ) | **ì ì •ê°€ê²©** (Proper Price) | **ì¢…ì „ìì‚° í‰ê°€ì•¡** |
        | **ê¸°ì¤€ ì‹œì ** | ê°€ê²©ì¡°ì‚¬ ì™„ë£Œì¼ | ê°€ê²©ì¡°ì‚¬ ì™„ë£Œì¼ | í˜‘ì˜/ì¬ê²° ë‹¹ì‹œ | **ì‚¬ì—…ì‹œí–‰ì¸ê°€ ê³ ì‹œì¼** |
        | **í‘œì¤€ì§€ ì„ ì •** | ê¸°ì¤€ì‹œì  ë‹¹í•´ë…„ë„ | ê¸°ì¤€ì‹œì  ë‹¹í•´ë…„ë„ | **ì‚¬ì—…ì¸ì •ê³ ì‹œì¼ ì „** ê³µì‹œì§€ê°€ | ê¸°ì¤€ì‹œì  ë‹¹í•´ë…„ë„ |
        | **ê°œë°œì´ìµ** | ë°˜ì˜í•¨ (í˜„í™© ê¸°ì¤€) | ë°˜ì˜í•¨ (í™˜ê°€ì„± ê³ ë ¤) | **ì² ì €íˆ ë°°ì œ** | ë°˜ì˜í•¨ (ê°œë°œ ê¸°ëŒ€ê° í¬í•¨) |
        | **í•µì‹¬ íŠ¹ì§•** | ì‹œì¥ì„± (ê°€ì¥ ë³´í¸ì ) | **ì•ˆì „ì„±** (ê²½ë§¤ë‚™ì°°ê°€ìœ¨ ê³ ë ¤) | **ê°œë°œì´ìµ ë°°ì œ** (ë²•ì •ì£¼ì˜) | **ë¹„ë¡€ìœ¨** ì‚°ì •ì´ ëª©ì  |
        """)

        st.divider()
        
        col_a, col_b = st.columns(2)
        with col_a:
            st.error("ğŸ›‘ **ë³´ìƒí‰ê°€ ì£¼ì˜ì‚¬í•­ (í† ì§€ë³´ìƒë²•)**")
            st.markdown("""
            * **í‘œì¤€ì§€:** ë°˜ë“œì‹œ 'ì‚¬ì—…ì¸ì •ê³ ì‹œì¼' ì´ì „ì˜ ê³µì‹œì§€ê°€ë¥¼ ì¨ì•¼ í•¨. (í•´ë‹¹ ì‚¬ì—…ìœ¼ë¡œ ì˜¤ë¥¸ ë•…ê°’ ë°°ì œ)
            * **ì‹œì ìˆ˜ì •:** í•´ë‹¹ ì‚¬ì—…ê³¼ ê´€ê³„ì—†ëŠ” ì¸ê·¼ ì‹œ/êµ°/êµ¬ ì§€ê°€ë³€ë™ë¥  ì‚¬ìš©.
            * **ê·¸ ë°–ì˜ ìš”ì¸:** ë³´ìƒ ì„ ë¡€ ì°¸ì‘ ì‹œì—ë„ ê°œë°œì´ìµì´ í¬í•¨ë˜ì§€ ì•Šì€ ì‚¬ë¡€ë¥¼ ì¨ì•¼ í•¨.
            """)
            
        with col_b:
            st.warning("ğŸ—ï¸ **ì •ë¹„ì‚¬ì—… í‰ê°€ ì£¼ì˜ì‚¬í•­ (ë„ì •ë²•)**")
            st.markdown("""
            * **ê¸°ì¤€ì‹œì :** ì¡°í•©ì› ë¶„ë‹´ê¸ˆì„ ì •í•˜ëŠ” 'ê´€ë¦¬ì²˜ë¶„ê³„íš' ìˆ˜ë¦½ì„ ìœ„í•œ í‰ê°€ëŠ” **ì‚¬ì—…ì‹œí–‰ì¸ê°€ ê³ ì‹œì¼**ì´ ê¸°ì¤€ì„.
            * **ëª©ì :** ì¡°í•©ì› ê°„ì˜ í˜•í‰ì„±(ë¹„ë¡€ìœ¨)ì„ ë§ì¶”ëŠ” ê²ƒì´ í•µì‹¬ì´ë¯€ë¡œ, ì ˆëŒ€ì  ê°€ê²©ë³´ë‹¤ ìƒëŒ€ì  ê°€ê²© ê· í˜•ì´ ì¤‘ìš”í•¨.
            """)
            
        st.info("ğŸ¦ **ë‹´ë³´í‰ê°€ Tip:** ë‹´ë³´í‰ê°€ëŠ” ì€í–‰ì´ ëˆì„ ë–¼ì´ì§€ ì•Šê²Œ í•˜ëŠ” ê²ƒì´ ëª©ì ì´ë¯€ë¡œ, ë‚˜ì¤‘ì— ê²½ë§¤ë¡œ ë„˜ì–´ê°”ì„ ë•Œ íŒ”ë¦´ ê°€ê²©(ë‚™ì°°ê°€ìœ¨)ì„ ê³ ë ¤í•˜ì—¬ **ë³´ìˆ˜ì ìœ¼ë¡œ í‰ê°€**í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.")
    st.divider()
    st.subheader("ğŸ“Œ ê°ì •í‰ê°€ 3ë°©ì‹ 6ë°©ë²• ìš”ì•½")
    
    col_a, col_b, col_c = st.columns(3)
    with col_a:
        st.error("**ë¹„êµë°©ì‹ (ì‹œì¥ì„±)**")
        st.write("1. ê±°ë˜ì‚¬ë¡€ë¹„êµë²•")
        st.write("2. ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•")
        st.write("3. ê³µì‹œì§€ê°€ê¸°ì¤€ë²•")
    with col_b:
        st.warning("**ì›ê°€ë°©ì‹ (ë¹„ìš©ì„±)**")
        st.write("4. ì›ê°€ë²•")
        st.write("5. ì ì‚°ë²•")
    with col_c:
        st.success("**ìˆ˜ìµë°©ì‹ (ìˆ˜ìµì„±)**")
        st.write("6. ìˆ˜ìµí™˜ì›ë²•")
        st.write("7. ìˆ˜ìµë¶„ì„ë²•")
# ==============================================================================
# 1. í† ì§€ í‰ê°€ (ê³µì‹œì§€ê°€ê¸°ì¤€ë²•)
# ==============================================================================
if menu == "í† ì§€ (ê³µì‹œì§€ê°€ê¸°ì¤€ë²•)":
    st.header("ğŸ“ í† ì§€ í‰ê°€: ê³µì‹œì§€ê°€ê¸°ì¤€ë²•")
    
    col_input, col_result = st.columns([1, 1.2])

    with col_input:
        st.subheader("1. ìš”ì¸ ì…ë ¥ (Inputs)")
        
        # 1) í‘œì¤€ì§€
        st.markdown("**â‘  í‘œì¤€ì§€ ê³µì‹œì§€ê°€ ($P_{std}$)**")
        p_std = st.number_input("í‘œì¤€ì§€ ë‹¨ê°€ (ì›/ã¡)", value=1000000, step=10000, format="%d")
        
        # 2) ì‹œì ìˆ˜ì •
        st.markdown("**â‘¡ ì‹œì ìˆ˜ì • ($Time$)**")
        time_mod = st.number_input("ì§€ê°€ë³€ë™ë¥  ì ìš©ì¹˜ (1+r)", value=1.035, format="%.4f", step=0.001, help="ê¸°ì¤€ì‹œì ê¹Œì§€ì˜ ì§€ê°€ë³€ë™ë¥ ")
        
        # 3) ì§€ì—­ìš”ì¸
        st.markdown("**â‘¢ ì§€ì—­ìš”ì¸ ($Reg$)**")
        reg_factor = st.number_input("ì§€ì—­ìš”ì¸ ë¹„êµì¹˜", value=1.000, format="%.3f", step=0.01, help="ì¸ê·¼ì§€ì—­ ì†Œì¬ ì‹œ 1.00")
        
        # 4) ê°œë³„ìš”ì¸
        st.markdown("**â‘£ ê°œë³„ìš”ì¸ ($Ind$)**")
        ind_factor = st.number_input("ê°œë³„ìš”ì¸ ë¹„êµì¹˜", value=1.100, format="%.3f", step=0.01, help="ê°€ë¡œ, ì ‘ê·¼, í™˜ê²½, íšì§€ ì¡°ê±´ ë“±")
        
        # 5) ê·¸ ë°–ì˜ ìš”ì¸
        st.markdown("**â‘¤ ê·¸ ë°–ì˜ ìš”ì¸ ($Other$)**")
        other_factor = st.number_input("ê¸°íƒ€ìš”ì¸ ë³´ì •ì¹˜", value=1.500, format="%.3f", step=0.01, help="ê±°ë˜ì‚¬ë¡€/í‰ê°€ì„ ë¡€ ì°¸ì‘")
        
        # 6) ë©´ì 
        area = st.number_input("ëŒ€ìƒë¬¼ê±´ ë©´ì  (ã¡)", value=165.0, format="%.1f")

    with col_result:
        st.subheader("2. ê³„ì‚° ê²°ê³¼ ë° í’€ì´")
        
        # ê³„ì‚° ë¡œì§
        final_unit_price = p_std * time_mod * reg_factor * ind_factor * other_factor
        final_total_price = final_unit_price * area
        
        # ê²°ê³¼ í‘œì‹œ
        st.success(f"ğŸ¯ ã¡ë‹¹ ë‹¨ê°€: {int(final_unit_price):,} ì›")
        st.error(f"ğŸ’° ì´ í‰ê°€ì•¡: {int(final_total_price):,} ì›")
        
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´ ê³¼ì •")
        st.latex(r'''
        P_{target} = P_{std} \times \text{ì‹œì } \times \text{ì§€ì—­} \times \text{ê°œë³„} \times \text{ê·¸ë°–}
        ''')
        
        calculation_text = f"""
        {p_std:,} (í‘œì¤€ì§€)
        x {time_mod:.4f} (ì‹œì ìˆ˜ì •)
        x {reg_factor:.3f} (ì§€ì—­ìš”ì¸)
        x {ind_factor:.3f} (ê°œë³„ìš”ì¸)
        x {other_factor:.3f} (ê·¸ ë°–ì˜ ìš”ì¸)
        ---------------------------
        = {int(final_unit_price):,} ì›/ã¡
        """
        st.code(calculation_text)

        # í•˜ë‹¨ ì´ë¡ /ë²•ê·œ ë…¸íŠ¸
        st.markdown("---")
        st.markdown('<div class="info-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ë²•ê·œ] ê°ì¹™ ì œ14ì¡°:** í† ì§€ëŠ” ê³µì‹œì§€ê°€ê¸°ì¤€ë²•ì´ ì›ì¹™. ì ì •í•œ ì‹¤ê±°ë˜ê°€ê°€ ìˆëŠ” ê²½ìš° ê±°ë˜ì‚¬ë¡€ë¹„êµë²• ê°€ëŠ¥.
        * **[ì´ë¡ /ì‹¤ë¬´] ì‚¬ì •ë³´ì • X:** í‘œì¤€ì§€ ê³µì‹œì§€ê°€ëŠ” ì´ë¯¸ ì ì • ê°€ê²©ì´ë¯€ë¡œ **ì‚¬ì •ë³´ì •(Speculation Check)ì„ ì ˆëŒ€ í•˜ì§€ ì•ŠìŒ.**
        * **[ì‹¤ë¬´ Tip]** ê·¸ ë°–ì˜ ìš”ì¸ ë³´ì •ì¹˜ëŠ” ì¸ê·¼ ì§€ì—­ì˜ ê±°ë˜ì‚¬ë¡€ë‚˜ í‰ê°€ ì„ ë¡€ë¥¼ ì—­ì‚°í•˜ì—¬ ì‚°ì¶œí•¨(ê°€ì¥ ë°°ì ì´ ë†’ê³  í‹€ë¦¬ê¸° ì‰¬ì›€).
        """)
        st.markdown('</div>', unsafe_allow_html=True)

# ==============================================================================
# 2. ê±´ë¬¼ í‰ê°€ (ì›ê°€ë²• - ê°ê°€ìˆ˜ì • ë°©ë²•ë³„ ë¹„êµ)
# ==============================================================================
elif menu == "ê±´ë¬¼ (ì›ê°€ë²•)":
    st.header("ğŸ—ï¸ ê±´ë¬¼ í‰ê°€: ì›ê°€ë²• (ê°ê°€ìˆ˜ì • 3ë°©ì‹)")
    st.markdown("ë‚´ìš©ì—°ìˆ˜ì— ì˜í•œ ê°ê°€ìˆ˜ì • ë°©ë²•(ì •ì•¡ë²•, ì •ë¥ ë²•, ìƒí™˜ê¸°ê¸ˆë²•) ë¹„êµ")
    
    # ê°ê°€ìˆ˜ì • ë°©ë²• ì„ íƒ
    dep_method = st.radio(
        "ê°ê°€ìˆ˜ì • ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”",
        ["ì •ì•¡ë²• (Straight-line)", "ì •ë¥ ë²• (Declining Balance)", "ìƒí™˜ê¸°ê¸ˆë²• (Sinking Fund)"],
        horizontal=True
    )

    col_input, col_result = st.columns([1, 1.2])
    
    with col_input:
        st.subheader("1. ì…ë ¥ (Inputs)")
        reprocurement_cost = st.number_input("ì¬ì¡°ë‹¬ì›ê°€ (C) (ì›)", value=500000000, step=1000000, format="%d")
        useful_life = st.number_input("ì „ì²´ ë‚´ìš©ì—°ìˆ˜ (Në…„)", value=40, step=1)
        elapsed_years = st.number_input("ê²½ê³¼ ì—°ìˆ˜ (në…„)", value=10, step=1)
        residual_ratio = st.slider("ì”ê°€ìœ¨ (R) (%)", 0, 30, 10) / 100
        
        # ìƒí™˜ê¸°ê¸ˆë²•ì¼ ë•Œë§Œ ì´ììœ¨ ì…ë ¥ì°½ì´ ëœ¨ë„ë¡ ì„¤ì •
        safe_rate = 0.0
        if "ìƒí™˜ê¸°ê¸ˆë²•" in dep_method:
            st.markdown("##### â• ìƒí™˜ê¸°ê¸ˆë²• ì¶”ê°€ ì…ë ¥")
            safe_rate = st.number_input("ì¶•ì ì´ìœ¨ (i) (%)", value=2.0, step=0.1, format="%.2f") / 100

    with col_result:
        st.subheader("2. ì ì‚°ê°€ì•¡ ì‚°ì¶œ")
        
        current_value = 0
        depreciation_total = 0
        
        # --- A. ì •ì•¡ë²• ê³„ì‚° ---
        if "ì •ì•¡ë²•" in dep_method:
            # ë§¤ë…„ ê°ê°€ì•¡ = C * (1-R) / N
            annual_dep = reprocurement_cost * (1 - residual_ratio) / useful_life
            depreciation_total = annual_dep * elapsed_years
            current_value = reprocurement_cost - depreciation_total
            
            st.markdown("### ğŸ“ ìˆ˜ì‹ (ì •ì•¡ë²•)")
            st.latex(r'''
            P = C - D_n = C - \left[ \underbrace{C(1-R)}_{\text{ëŒ€ìƒì•¡}} \times \frac{1}{N} \times n \right]
            ''')
            st.info("ë§¤ë…„ ê°ê°€ì•¡ì´ ì¼ì •í•¨ (ì§ì„  í˜•íƒœ)")

        # --- B. ì •ë¥ ë²• ê³„ì‚° ---
        elif "ì •ë¥ ë²•" in dep_method:
            # ì”ê°€ìœ¨ R = (1-d)^N  => ì •ë¥  d = 1 - R^(1/N)
            if residual_ratio <= 0:
                d = 0.9 # ì”ê°€ìœ¨ 0ì´ë©´ ê³„ì‚° ë¶ˆê°€í•˜ë¯€ë¡œ ì„ì˜ ì„¤ì • (ì´ë¡ ìƒ ì”ê°€ìœ¨>0 í•„ìš”)
                st.warning("ì •ë¥ ë²•ì€ ì”ê°€ìœ¨ì´ 0ë³´ë‹¤ ì»¤ì•¼ ì •í™•í•©ë‹ˆë‹¤.")
            else:
                d = 1 - (residual_ratio ** (1/useful_life))
            
            # në…„ í›„ ê°€ì¹˜ = C * (1-d)^n
            current_value = reprocurement_cost * ((1 - d) ** elapsed_years)
            depreciation_total = reprocurement_cost - current_value
            
            st.markdown(f"**ì‚°ì¶œëœ ìƒê°ë¥ (d):** {d*100:.2f}%")
            st.markdown("### ğŸ“ ìˆ˜ì‹ (ì •ë¥ ë²•)")
            st.latex(r'''
            P = C (1-d)^n \quad \left( \text{ë‹¨,} \ d = 1 - \sqrt[N]{R} \right)
            ''')
            st.info("ì´ˆê¸°ì— ê°ê°€ì•¡ì´ í¬ê³  ê°ˆìˆ˜ë¡ ì¤„ì–´ë“¦ (ì²´ê°ìƒê°)")

        # --- C. ìƒí™˜ê¸°ê¸ˆë²• ê³„ì‚° ---
        elif "ìƒí™˜ê¸°ê¸ˆë²•" in dep_method:
            # ê°ê°€ìƒê°ëŒ€ìƒì•¡ = C * (1-R)
            target_dep_amt = reprocurement_cost * (1 - residual_ratio)
            
            # ê°ì±„ê¸°ê¸ˆê³„ìˆ˜ (ë§¤ë…„ ì ë¦½ì•¡ ë¹„ìœ¨)
            if safe_rate == 0:
                sff = 1/useful_life
            else:
                sff = safe_rate / ((1 + safe_rate) ** useful_life - 1)
                
            # në…„ ë™ì•ˆì˜ ê°ê°€ëˆ„ê³„ì•¡ = ë§¤ë…„ì ë¦½ì•¡ * ì—°ê¸ˆì˜ ë‚´ê°€ê³„ìˆ˜
            # ì—°ê¸ˆë‚´ê°€í‘œ = ((1+i)^n - 1) / i
            if safe_rate == 0:
                future_value_factor = elapsed_years
            else:
                future_value_factor = ((1 + safe_rate) ** elapsed_years - 1) / safe_rate
            
            depreciation_total = (target_dep_amt * sff) * future_value_factor
            current_value = reprocurement_cost - depreciation_total
            
            st.markdown("### ğŸ“ ìˆ˜ì‹ (ìƒí™˜ê¸°ê¸ˆë²•)")
            st.latex(r'''
            D_n = \underbrace{C(1-R)}_{\text{ëŒ€ìƒì•¡}} \times \underbrace{\frac{i}{(1+i)^N - 1}}_{\text{ìƒí™˜ê¸°ê¸ˆìœ¨(SFF)}} \times \underbrace{\frac{(1+i)^n - 1}{i}}_{\text{ì—°ê¸ˆì˜ë‚´ê°€ê³„ìˆ˜}}
            ''')
            st.info("ì´ìê°€ ë¶™ìœ¼ë¯€ë¡œ ì‹¤ì œ ì ë¦½ ë¶€ë‹´ì´ ì ìŒ (ê°ê°€ì•¡ì´ ì ê²Œ ì¡í˜ â†’ ê°€ê²©ì´ ë†’ìŒ)")

        # ê²°ê³¼ í‘œì‹œ (ê³µí†µ)
        st.divider()
        st.write(f"**ê°ê°€ëˆ„ê³„ì•¡:** {int(depreciation_total):,} ì›")
        st.success(f"ğŸ¯ ì ì‚°ê°€ì•¡: {int(current_value):,} ì›")
        
        # --- [ë³´ë„ˆìŠ¤] ê·¸ë˜í”„ë¡œ ë¹„êµí•˜ê¸° ---
        st.markdown("---")
        st.subheader("ğŸ“Š ê°ê°€ìˆ˜ì • ê³¡ì„  ë¹„êµ (Graph)")
        
        import pandas as pd
        import numpy as np
        
        # 0ë…„ ~ Në…„ê¹Œì§€ ë°ì´í„° ìƒì„±
        years = list(range(0, int(useful_life) + 1))
        
        # 1. ì •ì•¡ë²• ë°ì´í„°
        val_straight = [reprocurement_cost * (1 - (1-residual_ratio)*(y/useful_life)) for y in years]
        
        # 2. ì •ë¥ ë²• ë°ì´í„°
        d_rate = 1 - (residual_ratio ** (1/useful_life))
        val_declining = [reprocurement_cost * ((1-d_rate)**y) for y in years]
        
        # 3. ìƒí™˜ê¸°ê¸ˆë²• ë°ì´í„° (ì´ìœ¨ 2% ê°€ì •)
        # ë¹„êµë¥¼ ìœ„í•´ ê³ ì •ì´ìœ¨ 2% ì‚¬ìš© (ì‚¬ìš©ì ì…ë ¥ê°’ì´ 0ì¼ìˆ˜ë„ ìˆì–´ì„œ)
        i_graph = 0.02
        sff_graph = i_graph / ((1 + i_graph) ** useful_life - 1)
        target_amt = reprocurement_cost * (1 - residual_ratio)
        val_sinking = []
        for y in years:
            acc_factor = ((1 + i_graph) ** y - 1) / i_graph
            dep_amt = target_amt * sff_graph * acc_factor
            val_sinking.append(reprocurement_cost - dep_amt)

        chart_data = pd.DataFrame({
            'ì—°ìˆ˜': years,
            'ì •ì•¡ë²•': val_straight,
            'ì •ë¥ ë²•': val_declining,
            'ìƒí™˜ê¸°ê¸ˆë²•(i=2%)': val_sinking
        }).set_index('ì—°ìˆ˜')
        
        st.line_chart(chart_data)
        st.caption("â–² ì ì‚°ê°€ì•¡ í¬ê¸° ë¹„êµ: ìƒí™˜ê¸°ê¸ˆë²• > ì •ì•¡ë²• > ì •ë¥ ë²• (ì´ˆê¸° ê¸°ì¤€)")

# ==============================================================================
# 3. ê±°ë˜ì‚¬ë¡€ë¹„êµë²• (ì¼ê´„/êµ¬ë¶„)
# ==============================================================================
elif menu == "í† ì§€ê±´ë¬¼ ì¼ê´„/êµ¬ë¶„ (ê±°ë˜ì‚¬ë¡€ë¹„êµë²•)":
    st.header("ğŸ˜ï¸ ê±°ë˜ì‚¬ë¡€ë¹„êµë²•")
    
    col_input, col_result = st.columns([1, 1.2])
    
    with col_input:
        st.subheader("1. ì‚¬ë¡€ ë° ë¹„êµì¹˜ ì…ë ¥")
        case_price = st.number_input("ì‚¬ë¡€ ê°€ê²© (ì›)", value=800000000, step=1000000, format="%d")
        
        # ì‚¬ì •ë³´ì • ìˆìŒ/ì—†ìŒ ì²´í¬
        is_speculation = st.checkbox("ì‚¬ì •ë³´ì • í•„ìš” (íŠ¹ìˆ˜ì‚¬ì • ê°œì…)", value=True)
        if is_speculation:
            spec_factor = st.number_input("ì‚¬ì •ë³´ì •ì¹˜", value=0.950, format="%.3f")
        else:
            spec_factor = 1.0
            
        time_factor = st.number_input("ì‹œì ìˆ˜ì •ì¹˜", value=1.020, format="%.3f")
        reg_factor = st.number_input("ì§€ì—­ìš”ì¸ ë¹„êµì¹˜", value=1.000, format="%.3f")
        ind_factor = st.number_input("ê°œë³„ìš”ì¸ ë¹„êµì¹˜", value=0.980, format="%.3f")
        area_ratio = st.number_input("ë©´ì ë¹„êµì¹˜ (ëŒ€ìƒ/ì‚¬ë¡€)", value=1.100, format="%.3f")
        
    with col_result:
        st.subheader("2. ë¹„ì¤€ê°€ì•¡ ì‚°ì¶œ")
        
        final_price = case_price * spec_factor * time_factor * reg_factor * ind_factor * area_ratio
        
        st.success(f"ğŸ¯ ë¹„ì¤€ê°€ì•¡: {int(final_price):,} ì›")
        
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´")
        st.latex(r'''
        P = P_{case} \times \text{ì‚¬ì •} \times \text{ì‹œì } \times \text{ì§€ì—­} \times \text{ê°œë³„} \times \text{ë©´ì }
        ''')
        
        st.code(f"""
        {case_price:,} (ì‚¬ë¡€)
        x {spec_factor} (ì‚¬ì •ë³´ì •)
        x {time_factor} (ì‹œì ìˆ˜ì •)
        x {reg_factor} (ì§€ì—­ìš”ì¸)
        x {ind_factor} (ê°œë³„ìš”ì¸)
        x {area_ratio} (ë©´ì ë¹„êµ)
        -----------------------
        = {int(final_price):,} ì›
        """)
        
        st.markdown("---")
        st.markdown('<div class="warning-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ë²•ê·œ] ê°ì¹™ ì œ16ì¡°:** ì§‘í•©ê±´ë¬¼(ì•„íŒŒíŠ¸, ì˜¤í”¼ìŠ¤í…” ë“±)ì€ ê±°ë˜ì‚¬ë¡€ë¹„êµë²•ì´ ì£¼ëœ ë°©ë²•.
        * **[ì´ë¡ ] ë°°ë¶„ë²•:** ì¼ê´„ ì‚¬ë¡€ ê°€ê²©ì—ì„œ í† ì§€/ê±´ë¬¼ ê°€ê²©ì„ êµ¬ë¶„í•´ì•¼ í•  ê²½ìš° 'ë¹„ìœ¨ ë°©ì‹' ë˜ëŠ” 'ê³µì œ ë°©ì‹' ì‚¬ìš© ê³ ë ¤.
        * **[ì£¼ì˜]** ì‚¬ì •ë³´ì •ì€ ì‚¬ë¡€ê°€ 'ì •ìƒì ì¸ ì‹œì¥'ì—ì„œ ê±°ë˜ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ì ìš©í•¨.
        """)
        st.markdown('</div>', unsafe_allow_html=True)
# ==============================================================================
# 4. ìˆ˜ìµì„± ë¶€ë™ì‚° (ìˆ˜ìµí™˜ì›ë²• - ìë³¸íšŒìˆ˜ë°©ë²•ë³„ 4ë°©ì‹)
# ==============================================================================
elif menu == "ìˆ˜ìµì„± ë¶€ë™ì‚° (ìˆ˜ìµí™˜ì›ë²•)":
    st.header("ğŸ’° ìˆ˜ìµí™˜ì›ë²•: ìë³¸íšŒìˆ˜ ë°©ë²•ì— ë”°ë¥¸ ë¶„ë¥˜")
    st.markdown("êµê³¼ì„œì— ë‚˜ì˜¨ **[ì§ì ‘ë²• / ì§ì„ ë²• / ìƒí™˜ê¸°ê¸ˆë²• / ì—°ê¸ˆë²•]** ì™„ë²½ ë¹„êµ")

    # 4ê°€ì§€ ë°©ë²• ì„ íƒ (êµê³¼ì„œ í‘œ ìˆœì„œëŒ€ë¡œ)
    method_option = st.radio(
        "í‰ê°€ ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”",
        ["1. ì§ì ‘ë²• (Direct)", "2. ì§ì„ ë²• (Straight-line)", "3. ìƒí™˜ê¸°ê¸ˆë²• (Hoskold)", "4. ì—°ê¸ˆë²• (Inwood)"],
        horizontal=True
    )
    
    st.divider()

    col1, col2 = st.columns([1, 1.3])

    # --- ê³µí†µ ì…ë ¥ê°’ ---
    with col1:
        st.subheader("1. ê¸°ì´ˆ ë°ì´í„° ì…ë ¥")
        a = st.number_input("ìˆœìˆ˜ìµ (a, NOI)", value=50000000, step=1000000, format="%d")
        r = st.number_input("ìë³¸ìˆ˜ìµë¥  (r, í• ì¸ìœ¨) (%)", value=6.0, step=0.1, format="%.2f") / 100
        
        # ì§ì ‘ë²• ì™¸ì—ëŠ” ë‚´ìš©ì—°ìˆ˜ í•„ìš”
        if "ì§ì ‘ë²•" not in method_option:
            n = st.number_input("ì”ì¡´ ë‚´ìš©ì—°ìˆ˜ (në…„)", value=20, step=1)
        
        # ìƒí™˜ê¸°ê¸ˆë²•ì€ ì•ˆì „ì´ìœ¨ í•„ìš”
        if "ìƒí™˜ê¸°ê¸ˆë²•" in method_option:
            i = st.number_input("ì•ˆì „ì´ìœ¨/ì¶•ì ì´ìœ¨ (i) (%)", value=2.0, step=0.1, format="%.2f") / 100

    # --- ê³„ì‚° ë° ìˆ˜ì‹ í‘œì‹œ ---
    with col2:
        st.subheader("2. êµê³¼ì„œ ìˆ˜ì‹ ë° í’€ì´")

        # -------------------------------------------------------
        # [1] ì§ì ‘ë²• (ì˜êµ¬í™˜ì›)
        # -------------------------------------------------------
        if "ì§ì ‘ë²•" in method_option:
            value = a / r
            
            st.latex(r'''
            V = \frac{a}{r}
            ''')
            st.info(f"ê³„ì‚°: {int(a):,} Ã· {r} = {int(value):,} ì›")
            
            st.markdown("---")
            st.markdown("#### ğŸ“– êµê³¼ì„œ ì´ë¡  Check")
            st.write("âœ”ï¸ **ìë³¸íšŒìˆ˜:** ë¶ˆìš” (ì˜êµ¬ì  ì†Œë“)")
            st.write("âœ”ï¸ **íŠ¹ì§•:** ë‚´ìš©ì—°ìˆ˜ê°€ ë¬´í•œí•œ ìì‚°")
            st.error("ğŸ“ **ì ìš©ëŒ€ìƒ:** í† ì§€, ë¹„ìƒê°ìì‚°")

        # -------------------------------------------------------
        # [2] ì§ì„ ë²• (ë‚´ìš©ì—°ìˆ˜ë²•)
        # -------------------------------------------------------
        elif "ì§ì„ ë²•" in method_option:
            # í™˜ì›ìœ¨ R = r + 1/n
            cap_recovery = 1 / n
            cap_rate = r + cap_recovery
            value = a / cap_rate
            
            st.latex(r'''
            V = \frac{a}{r + \frac{1}{n}}
            ''')
            
            st.write(f"**Â· ìë³¸ìˆ˜ìµë¥ (r):** {r*100:.2f}%")
            st.write(f"**Â· ìë³¸íšŒìˆ˜ìœ¨(1/n):** {cap_recovery*100:.2f}% (ì§ì„ ìƒê°)")
            st.metric("ì¢…í•© í™˜ì›ìœ¨ (R)", f"{cap_rate*100:.2f}%")
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(value):,} ì›")

            st.markdown("---")
            st.markdown("#### ğŸ“– êµê³¼ì„œ ì´ë¡  Check")
            st.write("âœ”ï¸ **ê°€ì •:** ë§¤ë…„ ì¼ì •ì•¡ ìë³¸íšŒìˆ˜, **ì¬íˆ¬ì ì—†ìŒ**")
            st.write("âœ”ï¸ **íŠ¹ì§•:** ì†Œë“ì´ ë§¤ë…„ ê°ì†Œí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ìì‚°")
            st.error("ğŸ“ **ì ìš©ëŒ€ìƒ:** ê±´ë¬¼(ë‚´ìš©ì—°ìˆ˜ ìœ í•œ), êµ¬ì¶•ë¬¼, ê¸°ê³„")

        # -------------------------------------------------------
        # [3] ìƒí™˜ê¸°ê¸ˆë²• (í˜¸ìŠ¤ì½œë“œ)
        # -------------------------------------------------------
        elif "ìƒí™˜ê¸°ê¸ˆë²•" in method_option:
            # í™˜ì›ìœ¨ R = r + i/((1+i)^n - 1)
            sff = i / ((1 + i) ** n - 1)
            cap_rate = r + sff
            value = a / cap_rate
            
            # êµê³¼ì„œ ìˆ˜ì‹ ëª¨ì–‘ ê·¸ëŒ€ë¡œ (ë¶„ìì— i)
            st.latex(r'''
            V = \frac{a}{r + \frac{i}{(1+i)^n - 1}}
            ''')
            
            st.write(f"**Â· ìë³¸ìˆ˜ìµë¥ (r):** {r*100:.2f}% (ìœ„í—˜ë¥ )")
            st.write(f"**Â· ìƒí™˜ê¸°ê¸ˆìœ¨(SFF @ i):** {sff*100:.4f}% (ì•ˆì „ì´ìœ¨ ì ìš©)")
            st.metric("ì¢…í•© í™˜ì›ìœ¨ (R)", f"{cap_rate*100:.4f}%")
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(value):,} ì›")
            
            st.markdown("---")
            st.markdown("#### ğŸ“– êµê³¼ì„œ ì´ë¡  Check")
            st.write("âœ”ï¸ **ê°€ì •:** íšŒìˆ˜ëœ ìë³¸ì„ **ì•ˆì „ì´ìœ¨(i)**ë¡œ ì¬íˆ¬ì")
            st.write("âœ”ï¸ **íŠ¹ì§•:** ìë³¸íšŒìˆ˜ë¶„ì´ ì ê²Œ ê³„ì‚°ë¨ -> í™˜ì›ìœ¨ ì‘ìŒ -> ê°€ì•¡ ë†’ê²Œ ë‚˜ì˜¬ ê²ƒ ê°™ì§€ë§Œ?")
            st.caption("*(ì£¼ì˜: ì´ë¡ ìƒ í˜¸ìŠ¤ì½œë“œëŠ” ìœ„í—˜ë¥  rì„ ë†’ê²Œ ì¡ìœ¼ë¯€ë¡œ ë³´í†µ ê°€ì•¡ì´ ê°€ì¥ ë‚®ê²Œ í‰ê°€ë¨)*")
            st.error("ğŸ“ **ì ìš©ëŒ€ìƒ:** ê´‘ì‚°, ì±„ì„ì¥, ê´‘ì—…ê¶Œ (ì†Œë©¸ì„± ìì‚°)")

        # -------------------------------------------------------
        # [4] ì—°ê¸ˆë²• (ì¸ìš°ë“œ)
        # -------------------------------------------------------
        elif "ì—°ê¸ˆë²•" in method_option:
            # í™˜ì›ìœ¨ R = r + r/((1+r)^n - 1)
            sff = r / ((1 + r) ** n - 1)
            cap_rate = r + sff
            value = a / cap_rate
            
            # êµê³¼ì„œ ìˆ˜ì‹ ëª¨ì–‘ ê·¸ëŒ€ë¡œ (ë¶„ìì— r)
            st.latex(r'''
            V = \frac{a}{r + \frac{r}{(1+r)^n - 1}}
            ''')
            
            st.write(f"**Â· ìë³¸ìˆ˜ìµë¥ (r):** {r*100:.2f}%")
            st.write(f"**Â· ìƒí™˜ê¸°ê¸ˆìœ¨(SFF @ r):** {sff*100:.4f}% (ìë³¸ìˆ˜ìµë¥  ì¬íˆ¬ì)")
            st.metric("ì¢…í•© í™˜ì›ìœ¨ (R)", f"{cap_rate*100:.4f}%")
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(value):,} ì›")
            
            st.markdown("---")
            st.markdown("#### ğŸ“– êµê³¼ì„œ ì´ë¡  Check")
            st.write("âœ”ï¸ **ê°€ì •:** íšŒìˆ˜ëœ ìë³¸ì„ **ìë³¸ìˆ˜ìµë¥ (r)**ë¡œ ì¬íˆ¬ì")
            st.write("âœ”ï¸ **íŠ¹ì§•:** ìˆ˜ìµì„± ë†’ì€ ê³³ì— ì¬íˆ¬ìí•˜ë¯€ë¡œ ê°€ì¹˜ê°€ ë†’ê²Œ í‰ê°€ë¨")
            st.error("ğŸ“ **ì ìš©ëŒ€ìƒ:** ì–´ì—…ê¶Œ, ì˜ì—…ê¶Œ, ì„ëŒ€ê¶Œ (ìƒê°ìì‚°)")

# ==============================================================================
# 5. ì„ëŒ€ë£Œ í‰ê°€ (ì ì‚°ë²•)
# ==============================================================================
elif menu == "ì„ëŒ€ë£Œ (ì ì‚°ë²•)":
    st.header("ğŸ“ˆ ì„ëŒ€ë£Œ í‰ê°€: ì ì‚°ë²•")
    
    col1, col2 = st.columns([1, 1.2])
    
    with col1:
        st.subheader("1. ê¸°ì´ˆë°ì´í„° ì…ë ¥")
        base_value = st.number_input("ê¸°ì´ˆê°€ì•¡ (ì›)", value=500000000, step=1000000, format="%d", help="ì„ëŒ€ ëŒ€ìƒ ë¬¼ê±´ì˜ ì›ë³¸ ê°€ì¹˜")
        exp_rate = st.number_input("ê¸°ëŒ€ì´ìœ¨ (%)", value=4.0, format="%.2f", step=0.1) / 100
        nec_exp = st.number_input("í•„ìš”ì œê²½ë¹„ (ì›/ë…„)", value=5000000, step=100000, format="%d", help="ê°ê°€ìƒê°ë¹„, ìœ ì§€ê´€ë¦¬ë¹„, ì¡°ì„¸ê³µê³¼ ë“±")
        
    with col2:
        st.subheader("2. ì ì‚°ì„ë£Œ ì‚°ì¶œ")
        
        base_rent = base_value * exp_rate  # ìˆœì„ë£Œ ìƒë‹¹ì•¡
        total_rent = base_rent + nec_exp   # ì ì‚°ì„ë£Œ
        
        st.success(f"ğŸ¯ ì—°ê°„ ì ì‚°ì„ë£Œ: {int(total_rent):,} ì›")
        st.info(f"ì›” í™˜ì‚° ì„ë£Œ: {int(total_rent/12):,} ì›")
        
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´")
        st.latex(r'''
        \text{ì„ë£Œ} = (\text{ê¸°ì´ˆê°€ì•¡} \times \text{ê¸°ëŒ€ì´ìœ¨}) + \text{í•„ìš”ì œê²½ë¹„}
        ''')
        
        st.code(f"""
        {int(base_value):,} (ê¸°ì´ˆê°€ì•¡)
        x {exp_rate} (ê¸°ëŒ€ì´ìœ¨)
        -----------------------
        = {int(base_rent):,} (ìˆœì„ë£Œ)
        + {int(nec_exp):,} (í•„ìš”ì œê²½ë¹„)
        -----------------------
        = {int(total_rent):,} ì›
        """)

        st.markdown("---")
        st.markdown('<div class="warning-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ì´ë¡ ] ê¸°ëŒ€ì´ìœ¨ vs í™˜ì›ìœ¨:** ê¸°ëŒ€ì´ìœ¨ì€ ì„ëŒ€ì°¨ ê¸°ê°„ ë™ì•ˆì˜ 'ì‚¬ìš©ëŒ€ê°€' ì„±ê²©ì´ê³ , í™˜ì›ìœ¨ì€ ì¥ë˜ ì†Œë“ì„ í˜„ì¬ê°€ì¹˜ë¡œ ë§Œë“œëŠ” 'ìë³¸í™”' ì„±ê²©ì„.
        * **[ë²•ê·œ] ê°ì¹™ ì œ22ì¡°:** ì„ëŒ€ë£ŒëŠ” **ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•**ì´ ì›ì¹™. ì ì‚°ë²•ì€ ì°¨ì„ ì±…ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ ì‹œì‚°ê°€ì•¡ ì¡°ì •ìš©ìœ¼ë¡œ ì”€.
        """)
        st.markdown('</div>', unsafe_allow_html=True)

# ==============================================================================
# 6. í• ì¸í˜„ê¸ˆìˆ˜ì§€ë¶„ì„ë²• (DCF) & ìë³¸íšŒìˆ˜ë°©ë²• ë¹„êµ
# ==============================================================================
elif menu == "íˆ¬ìíƒ€ë‹¹ì„±/ê°€ì¹˜ (í• ì¸í˜„ê¸ˆìˆ˜ì§€ë¶„ì„ë²• DCF)":
    st.header("ğŸ“‰ í• ì¸í˜„ê¸ˆìˆ˜ì§€ë¶„ì„ë²• ë° ìë³¸íšŒìˆ˜ë°©ë²•")
    st.markdown("ìˆ˜ìµì˜ íë¦„ê³¼ ìë³¸íšŒìˆ˜ ì´ë¡ ì— ë”°ë¥¸ 3ê°€ì§€ í‰ê°€ëª¨ë¸")
    
    # íƒ­ìœ¼ë¡œ 3ê°€ì§€ ë°©ë²• êµ¬ë¶„
    dcf_method = st.radio(
        "í‰ê°€ ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”", 
        ["Type A: ì¼ë°˜ DCF (ë³€ë™ì†Œë“)", "Type B: ì¸ìš°ë“œë²• (Inwood)", "Type C: í˜¸ìŠ¤ì½œë“œë²• (Hoskold)"],
        horizontal=True
    )
    
    st.divider()

    # ---------------------------------------------------
    # Type A: ì¼ë°˜ DCF (ê¸°ì¡´ê³¼ ë™ì¼ - ë³€ë™ì†Œë“ + ë³µê·€ê°€ì•¡)
    # ---------------------------------------------------
    if "Type A" in dcf_method:
        st.subheader("ğŸ…°ï¸ ì¼ë°˜ DCF (Standard)")
        st.info("ë§¤ë…„ ì†Œë“ì´ ë³€ë™í•˜ë©°, ê¸°ë§ì— ë¶€ë™ì‚°ì„ ë§¤ê°(ë³µê·€)í•˜ëŠ” ì¼ë°˜ì  ìƒí™©")

        col1, col2 = st.columns([1, 1.5])
        with col1:
            holding_period = st.slider("ë³´ìœ ê¸°ê°„ (në…„)", 1, 10, 5)
            initial_noi = st.number_input("1ì°¨ë…„ë„ ìˆœìˆ˜ìµ (NOI)", value=50000000, step=1000000, format="%d")
            growth_rate = st.number_input("ë§¤ë…„ ì†Œë“ ìƒìŠ¹ë¥  (%)", value=2.0, step=0.1, format="%.1f") / 100
            discount_rate = st.number_input("í• ì¸ìœ¨ (Y) (%)", value=7.0, step=0.1, format="%.2f") / 100
            terminal_cap_rate = st.number_input("ìµœì¢…í™˜ì›ìœ¨ (R_term) (%)", value=6.0, step=0.1, format="%.2f") / 100
        
        with col2:
            # ê³„ì‚° ë¡œì§
            pvs = []
            years = []
            total_pv_noi = 0
            
            for i in range(1, holding_period + 1):
                noi = initial_noi * ((1 + growth_rate) ** (i - 1))
                pv = noi / ((1 + discount_rate) ** i)
                pvs.append(pv)
                years.append(f"{i}ë…„")
                total_pv_noi += pv
            
            next_noi = initial_noi * ((1 + growth_rate) ** holding_period)
            reversion = next_noi / terminal_cap_rate
            reversion_pv = reversion / ((1 + discount_rate) ** holding_period)
            final_value = total_pv_noi + reversion_pv
            
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(final_value):,} ì›")
            
            # ì‹œê°í™”
            chart_data = {"êµ¬ë¶„": years + ["ë³µê·€ê°€ì•¡"], "í˜„ì¬ê°€ì¹˜": [int(p) for p in pvs] + [int(reversion_pv)]}
            st.bar_chart(chart_data, x="êµ¬ë¶„", y="í˜„ì¬ê°€ì¹˜")
            
            st.markdown("""
            **ğŸ’¡ íŠ¹ì§•:** ì†Œë“ì´ ë§¤ë…„ ë³€ë™($g \neq 0$)í•˜ê³ , ìë³¸íšŒìˆ˜ê°€ ë³´ìœ ê¸°ê°„ ë§ ì²˜ë¶„(ë³µê·€ê°€ì•¡)ì„ í†µí•´ ì´ë£¨ì–´ì§.
            """)

# ---------------------------------------------------
    # Type B: ì¸ìš°ë“œë²• (Inwood Method) - í™˜ì›ì´ìœ¨ ë°©ì‹
    # ---------------------------------------------------
    elif "Type B" in dcf_method:
        st.subheader("ğŸ…±ï¸ ì¸ìš°ë“œë²• (Inwood Method)")
        st.info("ë§¤ë…„ ì†Œë“ì´ ì¼ì •(í‰ì¤€)í•˜ë©°, íšŒìˆ˜ëœ ìë³¸ì„ 'í• ì¸ìœ¨(Y)'ë¡œ ì¬íˆ¬ìí•œë‹¤ê³  ê°€ì •.")

        col1, col2 = st.columns([1, 1.2])
        with col1:
            income = st.number_input("ë§¤ë…„ ìˆœìˆ˜ìµ (A)", value=30000000, step=1000000, format="%d")
            period = st.number_input("ìˆ˜ìµ ê¸°ê°„ (në…„)", value=10, step=1)
            rate = st.number_input("ìë³¸ìˆ˜ìµë¥ /í• ì¸ìœ¨ (Y or r) (%)", value=6.0, step=0.1, format="%.2f") / 100
            
        with col2:
            # í˜„ë™ë‹˜ì´ ìµìˆ™í•˜ì‹  ë°©ì‹: R = Y + SFF(Y)
            # SFF(Y) = r / ((1+r)^n - 1)
            
            if rate == 0:
                sff_y = 1 / period
            else:
                sff_y = rate / ((1 + rate) ** period - 1)
            
            cap_rate_inwood = rate + sff_y  # í™˜ì›ì´ìœ¨ R
            
            value = income / cap_rate_inwood
            
            st.metric("ìƒí™˜ê¸°ê¸ˆìœ¨ (SFF @ Y)", f"{sff_y:.5f}")
            st.metric("ì¢…í•© í™˜ì›ìœ¨ (R)", f"{cap_rate_inwood:.5f}")
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(value):,} ì›")
            
            st.markdown("### ğŸ“ ìˆ˜ì‹ (í™˜ì›ì´ìœ¨ ë°©ì‹)")
            st.latex(r'''
            V = \frac{A}{Y + \frac{Y}{(1+Y)^n - 1}}
            ''')
            st.write("(ë¶„ëª¨ì˜ ë’·ë¶€ë¶„ì´ í• ì¸ìœ¨ Yë¡œ êµ¬í•œ ìƒí™˜ê¸°ê¸ˆìœ¨ì…ë‹ˆë‹¤)")
            
            st.warning("""
            **âš ï¸ í˜¸ìŠ¤ì½œë“œë²•ê³¼ì˜ ì°¨ì´ì :**
            * ìˆ˜ì‹ í˜•íƒœëŠ” $R = Y + SFF$ ë¡œ ë™ì¼í•©ë‹ˆë‹¤.
            * ë‹¤ë§Œ, ì¸ìš°ë“œë²•ì€ SFFë¥¼ êµ¬í•  ë•Œ **í• ì¸ìœ¨(Y)**ì„ ì“°ê³ , í˜¸ìŠ¤ì½œë“œë²•ì€ **ì•ˆì „ì´ìœ¨(i)**ì„ ì”ë‹ˆë‹¤.
            """)

    # ---------------------------------------------------
    # Type C: í˜¸ìŠ¤ì½œë“œë²• (ì†Œë©¸ì„± ìì‚° + ì•ˆì „ì´ìœ¨)
    # ---------------------------------------------------
    elif "Type C" in dcf_method:
        st.subheader("Â©ï¸ í˜¸ìŠ¤ì½œë“œë²• (Hoskold Method)")
        st.info("ê´‘ì‚°ì²˜ëŸ¼ ìì‚°ì´ ì†Œë©¸ë˜ëŠ” ê²½ìš°. íšŒìˆ˜ëœ ìë³¸ì„ ë§¤ìš° ì•ˆì „í•œ 'ì•ˆì „ì´ìœ¨(i)'ë¡œ ì¬íˆ¬ìí•œë‹¤ê³  ê°€ì •.")

        col1, col2 = st.columns([1, 1.2])
        with col1:
            income = st.number_input("ë§¤ë…„ ìˆœìˆ˜ìµ (A)", value=50000000, step=1000000, format="%d")
            period = st.number_input("ì±„êµ´ ê°€ëŠ¥ ì—°ìˆ˜ (në…„)", value=20, step=1)
            spec_rate = st.number_input("ìœ„í—˜ë¥ /íˆ¬ê¸°ì ì´ìœ¨ (Y) (%)", value=10.0, step=0.1, format="%.2f", help="í•´ë‹¹ ì‚¬ì—…ì˜ ìš”êµ¬ìˆ˜ìµë¥ ") / 100
            safe_rate = st.number_input("ì•ˆì „ì´ìœ¨/ì¶•ì ì´ìœ¨ (i) (%)", value=3.0, step=0.1, format="%.2f", help="ì€í–‰ ì˜ˆê¸ˆ ê¸ˆë¦¬ ìˆ˜ì¤€ (êµ­ê³µì±„ ë“±)") / 100
            
        with col2:
            # í˜¸ìŠ¤ì½œë“œ ê³„ìˆ˜
            # Value = A / (Y + SFF_safe)
            # SFF_safe = i / ((1+i)^n - 1)
            
            sff = safe_rate / ((1 + safe_rate) ** period - 1) # ê°ì±„ê¸°ê¸ˆê³„ìˆ˜ (ì•ˆì „ì´ìœ¨ ì‚¬ìš©)
            capitalization_rate = spec_rate + sff             # ì¢…í•©í™˜ì›ìœ¨
            
            value = income / capitalization_rate
            
            st.metric("ìƒí™˜ê¸°ê¸ˆìœ¨ (SFF)", f"{sff:.5f}")
            st.metric("ì¢…í•© í™˜ì›ìœ¨ (R)", f"{capitalization_rate:.5f}")
            st.success(f"ğŸ’ ìˆ˜ìµê°€ì•¡: {int(value):,} ì›")
            
            st.markdown("### ğŸ“ ìˆ˜ì‹")
            st.latex(r'''
            V = \frac{A}{Y_{risk} + \frac{i}{(1+i)^n - 1}}
            ''')
            
            st.error("""
            **âš ï¸ í•µì‹¬ ì°¨ì´ì  (vs ì¸ìš°ë“œ):**
            * **ì¬íˆ¬ììœ¨:** ì¸ìš°ë“œëŠ” **í• ì¸ìœ¨(Y)**ë¡œ ì¬íˆ¬ìí•˜ì§€ë§Œ, í˜¸ìŠ¤ì½œë“œëŠ” ì•ˆì „í•œ **ì•ˆì „ì´ìœ¨(i)**ë¡œ ì¬íˆ¬ìí•¨.
            * **ê°€ì¹˜ ë¹„êµ:** ë³´í†µ ì•ˆì „ì´ìœ¨ì´ í• ì¸ìœ¨ë³´ë‹¤ ë‚®ìœ¼ë¯€ë¡œ, ë™ì¼ ì¡°ê±´ ì‹œ **í˜¸ìŠ¤ì½œë“œë²•ì— ì˜í•œ ê°€ì¹˜ê°€ ì¸ìš°ë“œë²•ë³´ë‹¤ ë‚®ê²Œ ë‚˜ì˜´** (ë³´ìˆ˜ì  í‰ê°€).
            """)
# ==============================================================================
# 7. ì”ì—¬ë²• & ë¬¼ë¦¬ì  íˆ¬ìê²°í•©ë²• (Residual Technique)
# ==============================================================================
elif menu == "í† ì§€/ê±´ë¬¼ ê°€ì¹˜ ë¶„ë¦¬ (ì”ì—¬ë²• & íˆ¬ìê²°í•©ë²•)":
    st.header("ğŸ° ì”ì—¬ë²• & ë¬¼ë¦¬ì  íˆ¬ìê²°í•©ë²•")
    st.markdown("ì „ì²´ ìˆœìˆ˜ìµ(NOI)ì„ í† ì§€ì™€ ê±´ë¬¼ì´ ê¸°ì—¬í•œ ëª«ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê°€ì¹˜ë¥¼ ì‚°ì •í•©ë‹ˆë‹¤.")

    # íƒ­ìœ¼ë¡œ ê¸°ëŠ¥ êµ¬ë¶„
    method_tab = st.radio("êµ¬í•˜ë ¤ëŠ” ê°€ì¹˜ëŠ”?", ["í† ì§€ ê°€ì¹˜ êµ¬í•˜ê¸° (í† ì§€ì”ì—¬ë²•)", "ê±´ë¬¼ ê°€ì¹˜ êµ¬í•˜ê¸° (ê±´ë¬¼ì”ì—¬ë²•)"], horizontal=True)
    
    col1, col2 = st.columns([1, 1.5])
    
    with col1:
        st.subheader("1. ì¡°ê±´ ì…ë ¥")
        noi = st.number_input("ì „ì²´ ìˆœì˜ì—…ì†Œë“ (NOI)", value=80000000, step=1000000, format="%d")
        
        if "í† ì§€" in method_tab:
            st.info("ê±´ë¬¼ì˜ ê°€ì¹˜ëŠ” ì›ê°€ë²• ë“±ìœ¼ë¡œ ì´ë¯¸ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.")
            known_value = st.number_input("ê¸°ì¡´ ê±´ë¬¼ ê°€ì¹˜ (V_B)", value=500000000, step=1000000, format="%d")
            known_label = "ê±´ë¬¼"
            target_label = "í† ì§€"
        else:
            st.info("í† ì§€ì˜ ê°€ì¹˜ëŠ” ê³µì‹œì§€ê°€ë²• ë“±ìœ¼ë¡œ ì´ë¯¸ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.")
            known_value = st.number_input("ê¸°ì¡´ í† ì§€ ê°€ì¹˜ (V_L)", value=800000000, step=1000000, format="%d")
            known_label = "í† ì§€"
            target_label = "ê±´ë¬¼"

        # í™˜ì›ìœ¨ ì…ë ¥
        st.markdown("##### í™˜ì›ìœ¨ ì„¤ì •")
        r_land = st.number_input("í† ì§€ í™˜ì›ìœ¨ (R_L) (%)", value=4.0, step=0.1, format="%.2f") / 100
        r_bldg = st.number_input("ê±´ë¬¼ í™˜ì›ìœ¨ (R_B) (%)", value=6.0, step=0.1, format="%.2f", help="ë³´í†µ ê°ê°€ìƒê°ë¥ ì´ ë”í•´ì ¸ í† ì§€í™˜ì›ìœ¨ë³´ë‹¤ ë†’ìŒ") / 100
        
        # í˜„ì¬ ì ìš©í•  í™˜ì›ìœ¨ ê²°ì •
        if target_label == "í† ì§€":
            target_cap_rate = r_land
            known_cap_rate = r_bldg
        else:
            target_cap_rate = r_bldg
            known_cap_rate = r_land

    with col2:
        st.subheader("2. ê°€ì¹˜ ì‚°ì • ë° ë°°ë¶„")
        
        # 1) ì•„ëŠ” ìì‚°ì— ê·€ì†ë˜ëŠ” ì†Œë“ ê³„ì‚°
        income_known = known_value * known_cap_rate
        
        # 2) ì”ì—¬ ì†Œë“ (ëª¨ë¥´ëŠ” ìì‚°ì˜ ëª«)
        income_residual = noi - income_known
        
        # 3) ëª¨ë¥´ëŠ” ìì‚°ì˜ ê°€ì¹˜ í™˜ì›
        if income_residual < 0:
            st.error("âš ï¸ ì—ëŸ¬: ì”ì—¬ ì†Œë“ì´ ë§ˆì´ë„ˆìŠ¤ì…ë‹ˆë‹¤! ì…ë ¥í•œ ìì‚° ê°€ì¹˜ê°€ ë„ˆë¬´ ë†’ê±°ë‚˜ í™˜ì›ìœ¨ì´ ê³¼ëŒ€í•©ë‹ˆë‹¤.")
            value_target = 0
        else:
            value_target = income_residual / target_cap_rate
            
        total_value = known_value + value_target
        weighted_r = (value_target/total_value * target_cap_rate) + (known_value/total_value * known_cap_rate)

        # ê²°ê³¼ ì¶œë ¥
        st.metric(f"êµ¬í•´ì§„ {target_label} ê°€ì¹˜", f"{int(value_target):,} ì›")
        st.success(f"ğŸ˜ï¸ ì „ì²´ ë¶€ë™ì‚° ê°€ì¹˜: {int(total_value):,} ì›")
        st.caption(f"(ì¢…í•© í™˜ì›ìœ¨: {weighted_r*100:.2f}%)")

        # ì‹œê°í™” (ë„ë„› ì°¨íŠ¸)
        import pandas as pd
        
        st.markdown("### ğŸ“Š ì†Œë“ì˜ ë°°ë¶„ (Income Split)")
        
        # ë°ì´í„°í”„ë ˆì„ ìƒì„± (ìŠ¤íŠ¸ë¦¼ë¦¿ ì°¨íŠ¸ìš©)
        df_income = pd.DataFrame({
            "Source": [f"{known_label} ê·€ì† ì†Œë“", f"{target_label} ê·€ì† ì†Œë“ (ì”ì—¬)"],
            "Amount": [income_known, income_residual]
        })
        
        # ë§‰ëŒ€ ì°¨íŠ¸ë¡œ ë¹„ì¤‘ ë³´ì—¬ì£¼ê¸°
        st.bar_chart(df_income, x="Source", y="Amount")
        
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´")
        st.latex(r'''
        V_{target} = \frac{NOI - (V_{known} \times R_{known})}{R_{target}}
        ''')
        
        st.code(f"""
        {int(noi):,} (ì „ì²´ NOI)
        - {int(income_known):,} ({known_label} ëª«: {int(known_value):,} x {known_cap_rate*100}%)
        ---------------------------
        = {int(income_residual):,} ({target_label} ê·€ì† ì”ì—¬ì†Œë“)
        Ã· {target_cap_rate} ({target_label} í™˜ì›ìœ¨)
        ---------------------------
        = {int(value_target):,} ì› ({target_label} ê°€ì¹˜)
        """)
        
        st.markdown("---")
        st.markdown('<div class="info-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ì´ë¡ ] ë¬¼ë¦¬ì  íˆ¬ìê²°í•©ë²•:** í† ì§€ì™€ ê±´ë¬¼ì˜ ì†Œë“ì°½ì¶œëŠ¥ë ¥ì´ ë‹¤ë¥´ê³ , ìœ„í—˜(í™˜ì›ìœ¨)ë„ ë‹¤ë¥´ë‹¤ëŠ” ê°€ì •ì—ì„œ ì¶œë°œí•¨.
        * **[ê³µì‹] $R_B > R_L$:** ê±´ë¬¼ì€ ì˜ì†ì ì´ì§€ ì•Šê³  ê°ê°€ìƒê°ì´ ë˜ë¯€ë¡œ, ìë³¸íšŒìˆ˜ë¶„ì´ í¬í•¨ëœ ê±´ë¬¼í™˜ì›ìœ¨ì´ í† ì§€í™˜ì›ìœ¨ë³´ë‹¤ ë†’ì€ ê²ƒì´ ì¼ë°˜ì ì„.
        * **[ì‹¤ë¬´]** í† ì§€ì”ì—¬ë²•ì€ ê±´ë¬¼ì´ ì‹ ì¶•(ìµœìœ íš¨ì´ìš©)ì¼ ë•Œ ê°€ì¥ ì •í™•í•˜ë©°, ì˜¤ë˜ëœ ê±´ë¬¼ì¼ìˆ˜ë¡ ì² ê±°ë¹„ ë“±ì˜ ë³€ìˆ˜ë¡œ ì¸í•´ ì‹ ë¢°ë„ê°€ ë‚®ì•„ì§.
        """)
        st.markdown('</div>', unsafe_allow_html=True)
# ==============================================================================
# 8. ì„ëŒ€ë£Œ í‰ê°€ (ì„ëŒ€ì‚¬ë¡€ë¹„êµë²• - ì›ì¹™)
# ==============================================================================
elif menu == "ì„ëŒ€ë£Œ (ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•)":
    st.header("ğŸ™ï¸ ì„ëŒ€ë£Œ í‰ê°€: ì„ëŒ€ì‚¬ë¡€ë¹„êµë²• (ì›ì¹™)")
    st.markdown("ì‚¬ë¡€ì˜ ì‹¤ì§ˆì„ëŒ€ë£Œë¥¼ ì‚°ì •í•˜ì—¬ ëŒ€ìƒ ë¬¼ê±´ì˜ ì ì • ì„ëŒ€ë£Œë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.")
    
    col1, col2 = st.columns([1, 1.3])
    
    with col1:
        st.subheader("1. ì„ëŒ€ì‚¬ë¡€ ë°ì´í„°")
        # ì‚¬ë¡€ì˜ ê³„ì•½ ë‚´ìš©
        case_deposit = st.number_input("ì‚¬ë¡€ ë³´ì¦ê¸ˆ (ì›)", value=100000000, step=1000000, format="%d")
        case_monthly = st.number_input("ì‚¬ë¡€ ì›”ì„¸ (ì›/ì›”)", value=3000000, step=100000, format="%d")
        case_maintenance = st.number_input("ì‚¬ë¡€ ê´€ë¦¬ë¹„ ë“± (ì‹¤ë¹„ì´ˆê³¼ë¶„ë§Œ) (ì›/ì›”)", value=0, step=10000, format="%d", help="ì‹¤ë¹„ìƒë‹¹ì•¡ì€ ì œì™¸í•˜ê³ , ì‹¤ì§ˆì  ì„ëŒ€ë£Œ ì„±ê²©ì¸ ë¶€ë¶„ë§Œ ì…ë ¥")
        
        st.markdown("##### âš™ï¸ ë³´ì¦ê¸ˆ ìš´ìš©ì´ìœ¨ (ì „í™˜ìœ¨)")
        conversion_rate = st.number_input("ë³´ì¦ê¸ˆ ì ìš© ì´ìœ¨ (%)", value=5.0, step=0.1, format="%.2f", help="ë³´ì¦ê¸ˆì„ ì›”ì„¸ë¡œ ì „í™˜í•˜ê±°ë‚˜ ìš´ìš©ìµì„ ê³„ì‚°í•  ë•Œ ì ìš©") / 100
        
        st.divider()
        st.subheader("2. ë¹„êµì¹˜ ì…ë ¥")
        spec_check = st.checkbox("ì‚¬ì •ë³´ì • í•„ìš” (íŠ¹ìˆ˜ê´€ê³„ ê±°ë˜ ë“±)", value=False)
        spec_factor = 1.0
        if spec_check:
            spec_factor = st.number_input("ì‚¬ì •ë³´ì •ì¹˜", value=1.000, format="%.3f")
            
        time_factor = st.number_input("ì‹œì ìˆ˜ì •ì¹˜", value=1.020, format="%.3f")
        reg_factor = st.number_input("ì§€ì—­ìš”ì¸ ë¹„êµì¹˜", value=1.000, format="%.3f")
        ind_factor = st.number_input("ê°œë³„ìš”ì¸ ë¹„êµì¹˜", value=1.050, format="%.3f")
        area_ratio = st.number_input("ë©´ì  ë¹„êµì¹˜ (ëŒ€ìƒ/ì‚¬ë¡€)", value=1.000, format="%.3f")

    with col2:
        st.subheader("3. ë¹„ì¤€ì„ë£Œ ì‚°ì¶œ")
        
        # [Step 1] ì‚¬ë¡€ì˜ ì‹¤ì§ˆì„ë£Œ ì‚°ì • (ì—°ê°„ ê¸°ì¤€)
        # ìš´ìš©ìµ = ë³´ì¦ê¸ˆ * ì´ìœ¨
        deposit_income = case_deposit * conversion_rate
        # ì—°ê°„ ì›”ì„¸ = ì›”ì„¸ * 12
        annual_monthly_rent = case_monthly * 12
        # ì—°ê°„ ê´€ë¦¬ë¹„ ìˆ˜ì… = ê´€ë¦¬ë¹„ * 12
        annual_maintenance = case_maintenance * 12
        
        # ì‚¬ë¡€ ì‹¤ì§ˆì„ë£Œ í•©ê³„
        case_real_rent = deposit_income + annual_monthly_rent + annual_maintenance
        
        # [Step 2] ë¹„ì¤€ì„ë£Œ ê³„ì‚°
        target_rent = case_real_rent * spec_factor * time_factor * reg_factor * ind_factor * area_ratio
        
        # ê²°ê³¼ ì¶œë ¥
        st.markdown(f"**â‘  ì‚¬ë¡€ ë³´ì¦ê¸ˆ ìš´ìš©ìµ:** {int(deposit_income):,} ì›")
        st.markdown(f"**â‘¡ ì‚¬ë¡€ ì—°ê°„ ì›”ì„¸:** {int(annual_monthly_rent):,} ì›")
        st.info(f"ğŸ‘‰ **ì‚¬ë¡€ ì—°ê°„ ì‹¤ì§ˆì„ë£Œ:** {int(case_real_rent):,} ì› (â‘ +â‘¡+ê´€ë¦¬ë¹„)")
        
        st.divider()
        st.success(f"ğŸ¯ ëŒ€ìƒ ë¬¼ê±´ ì—°ê°„ ë¹„ì¤€ì„ë£Œ: {int(target_rent):,} ì›")
        st.caption(f"ì›” í™˜ì‚°ì•¡: {int(target_rent/12):,} ì›")
        
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´")
        st.latex(r'''
        \text{ì„ë£Œ} = \text{ì‚¬ë¡€ì‹¤ì§ˆì„ë£Œ} \times \text{ì‚¬ì •} \times \text{ì‹œì } \times \text{ì§€ì—­} \times \text{ê°œë³„} \times \text{ë©´ì }
        ''')
        
        st.code(f"""
        {int(case_real_rent):,} (ì‚¬ë¡€)
        x {spec_factor} (ì‚¬ì •)
        x {time_factor} (ì‹œì )
        x {reg_factor} (ì§€ì—­)
        x {ind_factor} (ê°œë³„)
        x {area_ratio} (ë©´ì )
        -----------------------
        = {int(target_rent):,} ì›
        """)
        
        st.markdown("---")
        st.markdown('<div class="warning-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ë²•ê·œ] ê°ì¹™ ì œ22ì¡°:** ì„ëŒ€ë£Œë¥¼ ê°ì •í‰ê°€í•  ë•ŒëŠ” **ì„ëŒ€ì‚¬ë¡€ë¹„êµë²•**ì„ ì£¼ëœ ë°©ë²•ìœ¼ë¡œ ì ìš©í•˜ì—¬ì•¼ í•œë‹¤. (ì ì‚°ë²•ì€ ì˜ˆì™¸ì )
        * **[ì‹¤ë¬´] ì‹¤ì§ˆì„ë£Œ êµ¬ì„±:** ì§€ë¶ˆì„ë£Œ(ì›”ì„¸) + ì˜ˆê¸ˆì  ì„±ê²©ì˜ ì¼ì‹œê¸ˆ(ë³´ì¦ê¸ˆ)ì˜ ìš´ìš©ìµ + ì‹¤ë¹„ì´ˆê³¼ ê´€ë¦¬ë¹„ ë“±ì„ ëª¨ë‘ í•©ì‚°í•´ì•¼ í•¨.
        * **[íŒ]** ì¸µë³„ íš¨ìš©ë¹„(ê°œë³„ìš”ì¸)ê°€ ì„ëŒ€ë£Œ ê²©ì°¨ì— ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹¨. (1ì¸µ vs 2ì¸µ)
        """)
        st.markdown('</div>', unsafe_allow_html=True)
# ==============================================================================
# 9. ê³µê³µì‚¬ì—… ë³´ìƒ (ë³´ìƒí‰ê°€)
# ==============================================================================
elif menu == "ê³µê³µì‚¬ì—… ë³´ìƒ (ë³´ìƒí‰ê°€)":
    st.header("ğŸš§ ë³´ìƒí‰ê°€: í† ì§€ë³´ìƒë²• ì ìš©")
    st.markdown("ê°œë°œì´ìµì„ ë°°ì œí•œ 'ì ì •ê°€ê²©' ì‚°ì • (ì‚¬ì—…ì¸ì •ê³ ì‹œì¼ ê¸°ì¤€)")
    
    col1, col2 = st.columns([1, 1.3])
    
    with col1:
        st.subheader("1. ê¸°ì¤€ì‹œì  ë° í‘œì¤€ì§€ í™•ì •")
        # ë‚ ì§œ ì…ë ¥ ê¸°ëŠ¥
        project_date = st.date_input("ì‚¬ì—…ì¸ì • ê³ ì‹œì¼", datetime.date(2025, 1, 15))
        std_year = st.selectbox("ì ìš©í•  í‘œì¤€ì§€ ê³µì‹œë…„ë„", [project_date.year, project_date.year-1])
        
        st.info(f"ğŸ’¡ ì›ì¹™ì ìœ¼ë¡œ **{project_date.year}ë…„ 1ì›” 1ì¼** ê³µì‹œì§€ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë˜, í† ì§€ë³´ìƒë²• ì œ70ì¡°ì— ë”°ë¼ ì‚¬ì—…ì¸ì • ê³ ì‹œì¼ ì „ì˜ ì‹œì ì„ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.")

        st.subheader("2. ê°€ì•¡ ì‚°ì • ìš”ì¸")
        std_price = st.number_input("ë¹„êµí‘œì¤€ì§€ ê³µì‹œì§€ê°€ (ì›/ã¡)", value=2000000, step=10000, format="%d")
        
        # ë³´ìƒí‰ê°€ì˜ í•µì‹¬: ì‹œì ìˆ˜ì •
        st.markdown("##### â“ ì‹œì ìˆ˜ì • (ì§€ê°€ë³€ë™ë¥ )")
        time_factor = st.number_input("ì‹œì ìˆ˜ì •ì¹˜", value=1.015, format="%.4f", help="ì‚¬ì—…ì¸ì •ê³ ì‹œì¼ ì „ì˜ í‘œì¤€ì§€ ê³µì‹œê¸°ì¤€ì¼ë¶€í„° ê°€ê²©ì‹œì ê¹Œì§€ì˜ ë³€ë™ë¥  (í•´ë‹¹ ì‚¬ì—… ì˜í–¥ ë°°ì œ)")
        
        reg_factor = st.number_input("ì§€ì—­ìš”ì¸ (í‘œì¤€ì§€ vs ëŒ€ìƒ)", value=1.000, format="%.3f")
        ind_factor = st.number_input("ê°œë³„ìš”ì¸ (ê°€ë¡œ/ì ‘ê·¼/íšì§€ ë“±)", value=1.100, format="%.3f")
        other_factor = st.number_input("ê·¸ ë°–ì˜ ìš”ì¸ (ê¸°íƒ€ìš”ì¸)", value=1.350, format="%.3f", help="ì¸ê·¼ ë³´ìƒì„ ë¡€ ë“±ì„ ì°¸ì‘í•˜ë˜ ê°œë°œì´ìµì€ ë°°ì œ")
        
        area = st.number_input("í¸ì… ë©´ì  (ã¡)", value=330.0, format="%.1f")

    with col2:
        st.subheader("3. ë³´ìƒì•¡ ì‚°ì¶œ")
        
        unit_price = std_price * time_factor * reg_factor * ind_factor * other_factor
        total_comp = unit_price * area
        
        st.success(f"ğŸ’° í† ì§€ ë³´ìƒí‰ê°€ì•¡: {int(total_comp):,} ì›")
        st.caption(f"(ë‹¨ê°€: {int(unit_price):,} ì›/ã¡)")
        
        st.markdown("### ğŸ“ ë³´ìƒí‰ê°€ ì‚°ì‹")
        st.latex(r'''
        P_{comp} = P_{std} \times \text{ì‹œì (ë°°ì œ)} \times \text{ì§€ì—­} \times \text{ê°œë³„} \times \text{ê·¸ë°–}
        ''')
        
        st.code(f"""
        [ì ìš© í‘œì¤€ì§€: {std_year}ë…„ë„]
        {std_price:,} 
        x {time_factor} (ì‹œì ìˆ˜ì •: ê°œë°œì´ìµ ë°°ì œ)
        x {reg_factor} (ì§€ì—­ìš”ì¸)
        x {ind_factor} (ê°œë³„ìš”ì¸)
        x {other_factor} (ê·¸ ë°–ì˜ ìš”ì¸)
        -----------------------
        = {int(unit_price):,} ì›/ã¡
        """)
        
        st.markdown("---")
        st.markdown('<div class="warning-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ë²•ê·œ] í† ì§€ë³´ìƒë²• ì œ70ì¡°:** ë³´ìƒì•¡ì€ **ì‚¬ì—…ì¸ì •ê³ ì‹œì¼ ì „**ì˜ í˜‘ì˜ ì„±ë¦½ ë‹¹ì‹œ ë˜ëŠ” ìˆ˜ìš©ì¬ê²° ë‹¹ì‹œì˜ ê³µì‹œì§€ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•¨.
        * **[ì´ë¡ ] ê°œë°œì´ìµ ë°°ì œ:** í•´ë‹¹ ê³µìµì‚¬ì—…ìœ¼ë¡œ ì¸í•œ ì§€ê°€ ìƒìŠ¹ë¶„ì€ ì² ì €íˆ ë°°ì œí•´ì•¼ í•˜ë¯€ë¡œ, ì‹œì ìˆ˜ì • ì‹œ í•´ë‹¹ ì‚¬ì—…ê³¼ ê´€ê³„ì—†ëŠ” ì¸ê·¼ ì‹œêµ°êµ¬ì˜ ì§€ê°€ë³€ë™ë¥ ì„ ì”€.
        * **[ì‹¤ë¬´] ê·¸ ë°–ì˜ ìš”ì¸:** ë³´ìƒí‰ê°€ì—ì„œ ê°€ì¥ ë…¼ë€ì´ ë˜ëŠ” ë¶€ë¶„. ì¸ê·¼ì˜ ì •ìƒì ì¸ ê±°ë˜ì‚¬ë¡€ë‚˜ ë³´ìƒì„ ë¡€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë˜, ê·¸ ì„ ë¡€ì— ê°œë°œì´ìµì´ í¬í•¨ë˜ì—ˆëŠ”ì§€ ê²€í†  í•„ìš”.
        """)
        st.markdown('</div>', unsafe_allow_html=True)

# ==============================================================================
# 10. ì¬ê°œë°œ/ì¬ê±´ì¶• (ì •ë¹„ì‚¬ì—…í‰ê°€)
# ==============================================================================
elif menu == "ì¬ê°œë°œ/ì¬ê±´ì¶• (ì •ë¹„ì‚¬ì—…í‰ê°€)":
    st.header("ğŸ—ï¸ ì •ë¹„ì‚¬ì—…í‰ê°€: ì¢…ì „ìì‚° & ë¶„ë‹´ê¸ˆ")
    st.markdown("ë¹„ë¡€ìœ¨(%) ì‚°ì •ì„ í†µí•´ ì¡°í•©ì›ì˜ ê¶Œë¦¬ê°€ì•¡ê³¼ ë¶„ë‹´ê¸ˆì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.")

    col1, col2 = st.columns([1, 1.2])

    with col1:
        st.subheader("1. ì‚¬ì—… ì „ì²´ ê°œìš” (ì¡°í•©)")
        total_revenue = st.number_input("ì´ ìˆ˜ì… ì¶”ì‚°ì•¡ (ì¢…í›„ìì‚° ì´ì•¡) (ì–µ ì›)", value=5000, step=10, help="ì•„íŒŒíŠ¸/ìƒê°€ ì¼ë°˜ë¶„ì–‘ + ì¡°í•©ì›ë¶„ì–‘ ìˆ˜ì… í•©ê³„") * 100000000
        total_cost = st.number_input("ì´ ì‚¬ì—…ë¹„ ì¶”ì‚°ì•¡ (ê³µì‚¬ë¹„ ë“±) (ì–µ ì›)", value=3500, step=10) * 100000000
        total_before_asset = st.number_input("ì¢…ì „ìì‚° í‰ê°€ì•¡ ì´í•© (ì–µ ì›)", value=1200, step=10, help="ì¡°í•©ì›ë“¤ì´ ê°€ì§„ ê¸°ì¡´ í† ì§€/ê±´ë¬¼ì˜ ê°ì •í‰ê°€ì•¡ í•©ê³„") * 100000000
        
        st.divider()
        st.subheader("2. ë‚˜ì˜ ìì‚° (ê°œë³„ ì¡°í•©ì›)")
        my_appraisal = st.number_input("ë‚´ ì¢…ì „ìì‚° í‰ê°€ì•¡ (ì›)", value=800000000, step=10000000, format="%d", help="ê°ì •í‰ê°€ì‚¬ê°€ í‰ê°€í•œ ë‚´ í—Œ ì§‘ ê°€ê²©")
        target_apt_price = st.number_input("ì…ì£¼í¬ë§ í‰í˜• ì¡°í•©ì›ë¶„ì–‘ê°€ (ì›)", value=1100000000, step=10000000, format="%d")

    with col2:
        st.subheader("3. ê²°ê³¼ ë¶„ì„: ë¶„ë‹´ê¸ˆ vs í™˜ê¸‰ê¸ˆ")
        
        # [Step 1] ë¹„ë¡€ìœ¨ ê³„ì‚°
        # ë¹„ë¡€ìœ¨ = (ì´ìˆ˜ì… - ì´ë¹„ìš©) / ì¢…ì „ìì‚°ì´ì•¡
        if total_before_asset == 0:
            proportional_rate = 0
        else:
            proportional_rate = (total_revenue - total_cost) / total_before_asset
        
        # [Step 2] ê¶Œë¦¬ê°€ì•¡ ê³„ì‚°
        my_rights_value = my_appraisal * proportional_rate
        
        # [Step 3] ë¶„ë‹´ê¸ˆ ê³„ì‚° (ë¶„ì–‘ê°€ - ê¶Œë¦¬ê°€ì•¡)
        contribution = target_apt_price - my_rights_value
        
        # ê²°ê³¼ ì‹œê°í™”
        st.metric("ğŸ“Š ë¹„ë¡€ìœ¨ (ì‚¬ì—…ì„± ì§€í‘œ)", f"{proportional_rate*100:.2f} %")
        if proportional_rate > 1.0:
            st.caption("â–² 100% ì´ˆê³¼: ì‚¬ì—…ì„±ì´ ìš°ìˆ˜í•¨ (ê¶Œë¦¬ê°€ì•¡ ì¦ê°€)")
        else:
            st.caption("â–¼ 100% ë¯¸ë§Œ: ì‚¬ì—…ì„±ì´ ë‚®ìŒ (ê¶Œë¦¬ê°€ì•¡ ê°ì†Œ)")
            
        st.divider()
        st.markdown(f"**ğŸ¡ ë‚´ ì¢…ì „ìì‚° í‰ê°€ì•¡:** {int(my_appraisal):,} ì›")
        st.markdown(f"**â• ë¹„ë¡€ìœ¨ ì ìš© ê¶Œë¦¬ê°€ì•¡:** **{int(my_rights_value):,} ì›**")
        
        if contribution > 0:
            st.error(f"ğŸ’¸ ë‚©ë¶€í•  ë¶„ë‹´ê¸ˆ: {int(contribution):,} ì›")
        else:
            st.success(f"ğŸ’° ëŒë ¤ë°›ì„ í™˜ê¸‰ê¸ˆ: {int(abs(contribution)):,} ì›")
            
        st.markdown("### ğŸ“ ìˆ˜ì‹ í’€ì´")
        st.latex(r'''
        \text{ë¹„ë¡€ìœ¨} = \frac{\text{ì´ìˆ˜ì…} - \text{ì´ì‚¬ì—…ë¹„}}{\text{ì¢…ì „ìì‚°í‰ê°€ì´ì•¡}} \times 100
        ''')
        st.latex(r'''
        \text{ë¶„ë‹´ê¸ˆ} = \text{ì¡°í•©ì›ë¶„ì–‘ê°€} - (\text{ë‚´ ì¢…ì „ìì‚°} \times \text{ë¹„ë¡€ìœ¨})
        ''')

        st.markdown("---")
        st.markdown('<div class="info-box">', unsafe_allow_html=True)
        st.markdown("#### ğŸ’¡ í•µì‹¬ Check Point")
        st.markdown("""
        * **[ë²•ê·œ] ë„ì‹œì •ë¹„ë²•:** ê´€ë¦¬ì²˜ë¶„ê³„íš ìˆ˜ë¦½ ì‹œ ì¢…ì „ìì‚° ê°€ê²©ì€ 'ì‚¬ì—…ì‹œí–‰ì¸ê°€ ê³ ì‹œì¼'ì´ ê¸°ì¤€ì„.
        * **[ì‹¤ë¬´] ë¹„ë¡€ìœ¨ ì¡°ì •:** ì¡°í•©ì€ ë¹„ë¡€ìœ¨ì„ 100% ê·¼ì²˜ë¡œ ë§ì¶”ê¸° ìœ„í•´ ê³µì‚¬ë¹„(ë¹„ìš©)ë‚˜ ì¼ë°˜ë¶„ì–‘ê°€(ìˆ˜ì…)ë¥¼ ì¡°ì •í•˜ê¸°ë„ í•¨.
        * **[ìš©ì–´] ê¶Œë¦¬ê°€ì•¡:** ì¡°í•©ì›ì´ ì‹¤ì œ ì¬ì‚°ìœ¼ë¡œ ì¸ì •ë°›ëŠ” ê¸ˆì•¡. (ê°ì •í‰ê°€ì•¡ì´ ì•„ë‹˜! ê°í‰ì•¡ì— ë¹„ë¡€ìœ¨ì„ ê³±í•´ì•¼ í•¨)
        """)
        st.markdown('</div>', unsafe_allow_html=True)